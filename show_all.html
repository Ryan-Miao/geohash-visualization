<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>geohash</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="./jquery.min.js"></script>
    <script src="./latlon-geohash.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=rTftA1rhmp7dbId0B2j3qTd2"></script>

    <style type="text/css">
        body,
        html {
            width: 100%;
            height: 100%;
            margin: 0;
            font-family: "微软雅黑";
        }

        #allmap {
            height: 1200px;
            width: 100%;
        }

        #control {
            width: 100%;
        }
    </style>
</head>

<body>

    
    <textarea name="all_geohash" id="all_geohash" cols="30" rows="10"></textarea>
   
    <input type="button" value="显示覆盖" id="search">


    <div id="allmap"></div>


    <script type="text/javascript">
        
        var map = new BMap.Map("allmap");
        var bp_arr = new Array();
        // 根据点的数组自动调整缩放级别
        function set_zoom(bp_arr) {
            var view = map.getViewport(eval(bp_arr));
            var mapZoom = view.zoom;
            var centerPoint = view.center;
            map.centerAndZoom(centerPoint, mapZoom);
        }
        /**
         * 经纬度数组，会连成一条线
         * */
        function add_ploygon(p_arr) {
            var point_arr = p_arr.map(function (item, index) {
                var bp = new BMap.Point(item.longitude, item.latitude);
                bp_arr.push(bp);
                var marker = new BMap.Marker(bp);  // 创建标注
	            map.addOverlay(marker);              // 将标注添加到地图中
                var label = new BMap.Label(item.geohash,{offset:new BMap.Size(10,-10)});
                marker.setLabel(label);
                return bp;
            });
            // var polygon = new BMap.Polygon(point_arr, { strokeColor: "blue", strokeWeight: 2, strokeOpacity: 0.5 });  //创建多边形
            // map.addOverlay(polygon);   //增加多边形  
        }

        function calculate_geohash(){
            var all_geo_str = $("#all_geohash").val();
            var all_arr = all_geo_str.split("\n");
            console.log(all_arr);
            var points = all_arr.map(geohash_str => {
                var decoded_gps = Geohash.decode(geohash_str);
                var cur_geo = {
                    longitude: decoded_gps.lon,
                    latitude: decoded_gps.lat,
                    geohash: geohash_str
                    
                };
                return cur_geo;
            });

            return points;
        }
       
    </script>

    
<script>

        $(function () {
            $("#search").click(init);

        });

        function init(){
            // 百度地图API功能
            map = new BMap.Map("allmap");
            map.centerAndZoom(new BMap.Point(116.404, 39.915), 15);
            map.enableScrollWheelZoom();

            all_p = calculate_geohash();
            add_ploygon(all_p);
            
        }


        init();

    </script>

</body>

</html>